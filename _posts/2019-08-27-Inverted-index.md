---
layout: post
title: ES--浅谈倒排索引
categories: Java, Distributed
description: 倒排索引详解
keywords: Java, Distributed
---

> ELK的核心就是ES，而ES是在Lucene的基础上做了一层REST的封装 ，来作为WEB服务供方便外部，

Lucene其实就是一个支持全文索引的工具包，其特殊就是由于内部使用的倒叙索引。__倒排索引由在文档中出现的唯一的单词列表，以及对于每个单词在文档中的位置组成。__ 不同于以往的各种索引结构（由对应的记录获取他的属性。而是通过记录的属性获取到他的记录位置。）
可以理解为他是面向分词（Term）的，而不是所查询的文档的。倒排索引建立的是分词（Term）和文档（Document）之间的映射关系

首先，我们需要理解几个概念：
* 词典文件 (Term Dictionary) :保存所有关键词，指向频率文件和位置文件的指针。
* 频率文件 (frequencies) ：该词是文章中的次数
* 位置文件 (positions) ：该词是文章中第几个关键词

我们下面举个栗子来讲解：

    1.我今天是走路来上班的。
    2.中午我要点个外卖。
    
既然倒排索引是一个面向分词的索引，首先，当他获得一个文档之后，会进行一个解析的工作（由Analyzer类完成）。
> _这很重要。你只可以找到确实存在于索引中的词，所以索引文本和查询字符串都要标准化为相同的形式。
这个标记化和标准化的过程叫做 __解析__ (analysis)，_


值得一提的是，由于英文每个词都是由空格分隔，所以比较好区别，但是中文的分词就比较复杂了，需要使用到专门的解析器。而且一些常用的虚词，比如说：“是” ，“的” 等无特别含义的字会在处理的时候被过滤掉。

    [我] [今天] [走路] [上班] 。
    [中午] [我] [点] [外卖]。
然后我们就得到下面的表格

| Term Dictionary  | DocID(frequencies) | positions 
| ----- | :------  | :------- |
| 我     | 1(1) ,2(1)  | 1,2         | 
| 今天     | 1(1)      | 2         | 
| 走路     | 1(1)      | 4         | 
| 中午     | 2(1)      | 1         | 
| 上班     | 1(1)      | 4         | 
| 点     | 2(1)      | 3         | 
| 外卖     | 2(1)      | 4        | 

当进行搜索的时候，就可以根据对应的分词去到 Term Dictionary 根据二分查找（分词根据字母顺序排列）拿到对应的记录。然后获取对应的DocID 以及所在的位置。就可以找到对应的文档了。

